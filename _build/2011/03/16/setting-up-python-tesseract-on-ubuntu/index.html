<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head>


<link href="/a/mattdeboard.net/blog/static/style.css" rel="stylesheet" type="text/css"> 
<link href="/a/mattdeboard.net/blog/static/_pygments.css" rel="stylesheet" type="text/css"> 
<link href="http://fonts.googleapis.com/css?family=Vollkorn&subset=latin" rel="stylesheet" type="text/css"> 
<link href="http://fonts.googleapis.com/css?family=Rock+Salt" rel="stylesheet" type="text/css">
        <title>MattDeBoard.net - </title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    </head>
    <body><div id="main">
	<div id="header"><span class="header"><a href="http://mattdeboard.net">Matt DeBoard</a></span></div>

	<div id="menu"><span class="menu">
		<a href="http://mattdeboard.net/projects/">projects</a> | 
		<a href="http://twitter.com/#%21/matt_deboard" target="_blank">twitter</a> | 
		<a href="https://github.com/mattdeboard" target="_blank">github</a> | 
		<a href="http://mattdeboard.tumblr.com" target="_blank">tumblr archives</a> | 
		<a href="http://mattdeboard.net/feed.atom" target="_blank">rss feed</a> |
			</span>
	</div>

	<div id="content">
    
  
  
  <p class=date>written on Wednesday, March 16, 2011
  

  <p>public: yes
tags: [ocr]</p>
<div class="section" id="foo">
<h2>foo</h2>
<p>After downloading, you'll notice that the font files (*.tif) are named in the format <em>eng.arialbd.g4.tif</em>, while the box files are named <em>eng.arialbd.box</em>. If you try to run:</p>
<div class="highlight"><pre>tesseract eng.arialbd.g4.tiff eng.arialbd nobatch box.train.stderr
</pre></div>
<p>Tesseract will return the following error (included here for the sake of folks Googling for a solution):</p>
<div class="highlight"><pre>Tesseract Open Source OCR Engine with LibTiff
read_next_box<span class="se">\:</span>Error<span class="se">\:</span>Can<span class="err">&#39;</span>t open file<span class="se">\:</span>Cant open box file eng.arialbd.g4.box 2
Segmentation fault
</pre></div>
<p>The issue is that Tesseract is looking for a boxfile that exactly matches the .tif, so we've got to get that &quot;.g4&quot; in there. Instead of renaming each file individually, I wrote a Python script:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="c"># Make sure to change this to wherever your Tesseract install is looking</span>
<span class="c"># for the data files.</span>
<span class="n">boxfile_directory</span> <span class="o">=</span> <span class="s">&#39;/usr/local/share/tessdata&#39;</span>

<span class="n">tif_files</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">boxfile</span>\<span class="n">_directory</span><span class="p">):</span>
    <span class="n">root</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">extension</span> <span class="o">==</span> <span class="s">&#39;.box&#39;</span><span class="p">:</span>
    <span class="c"># Obviously adjust this to your particular batch of tiff/box file</span>
    <span class="c"># pairs. It may not be &quot;g4&quot; for you, I just hardcoded for sake</span>
    <span class="c"># of expediency.</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s">&#39;.g4.box&#39;</span><span class="p">))</span>

<span class="k">if</span> <span class="n">extension</span> <span class="o">==</span> <span class="s">&#39;.tif&#39;</span><span class="p">:</span>
    <span class="n">tif_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

<span class="k">for</span> <span class="n">tif_file</span> <span class="ow">in</span> <span class="n">tif_files</span><span class="p">:</span>
    <span class="n">tif</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tif_file</span><span class="o">+</span><span class="s">&#39;.tif&#39;</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s">&quot;tesseract&quot;</span><span class="p">,</span> <span class="n">tif</span><span class="p">,</span> <span class="n">tif_file</span><span class="p">,</span>
                     <span class="s">&quot;nobatch&quot;</span><span class="p">,</span><span class="s">&quot;box.train.stderr&quot;</span><span class="p">])</span>
</pre></div>
<p>There.</p>
</div>


  

</div>


<div id="footer"><span class="foot"></span></div>

      
        
        <div id="disqus_thread"></div>
          <script type="text/javascript">
            var disqus_shortname = 'mattdeboard';

            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
        
      

</div>
    </body>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-12348858-1");
pageTracker._trackPageview();
} catch(err) {}</script>
</html>
